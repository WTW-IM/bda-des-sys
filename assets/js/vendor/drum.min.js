(function(e){"use strict";var t=function(){var t=function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)};var n=function(n,r){var i=e(t("svg"));e(i).attr("width",n);e(i).attr("height",r);var s=e(t("g"));e(i).append(s);return i};var r=function(t){var n=document.createElement("div");e(n).attr("class",t);var r=document.createElement("div");e(n).append(r);return n};var i=function(n){var r=e(t("path"));var i={fill:"none",stroke:n.dial_stroke_color,"stroke-width":n.dial_stroke_width+"px","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-opacity":"1"};var s="";for(var o in i){e(r).attr(o,i[o])}return r};return{up:function(t){var s=t.dial_w;var o=t.dial_h;var u=n(s,o);var a=i(t);e(a).attr("d","m0,"+(o+t.dial_stroke_width)+"l"+s/2+",-"+o+"l"+s/2+","+o);e(u).find("g").append(a);var f=r("dial up");e(f).find("div").append(u);return f},down:function(t){var s=t.dial_w;var o=t.dial_h;var u=n(s,o);var a=i(t);e(a).attr("d","m0,-"+t.dial_stroke_width+"l"+s/2+","+o+"l"+s/2+",-"+o);e(u).find("g").append(a);var f=r("dial down");e(f).find("div").append(u);return f}}}();var n=function(t,n,r){this.index=t;this.dataModel=new function(e,t){this.data=e;this.index=t;this.getText=function(){return this.data[this.index]}}(r.data,n);this.init=function(){this.angle=r.theta*t;this.elem=document.createElement("figure");e(this.elem).addClass("a"+this.angle*100);e(this.elem).css("opacity","0.5");e(this.elem).css(r.transformProp,r.rotateFn+"("+ -this.angle+"deg) translateZ("+r.radius+"px)");this.setText()};this.setText=function(){e(this.elem).text(this.dataModel.getText())};this.update=function(e){if(this.dataModel.index!=e){this.dataModel.index=e;this.setText()}}};var r=function(r,i,s){var o=e(r)[0];var u=this;var a=e.extend({panelCount:16,rotateFn:"rotateX",interactive:true,dial_w:20,dial_h:5,dial_stroke_color:"#999999",dial_stroke_width:1},i||{});a.transformProp=s;a.rotation=0;a.distance=0;a.last_angle=0;a.theta=360/a.panelCount;a.initselect=o.selectedIndex;if(a.transformProp){a.data=[];for(var f=0;f<o.children.length;f++){a.data.push(e(o.children[f]).text())}e(r).hide();var l=document.createElement("div");e(l).addClass("drum-wrapper");if(a.id)e(l).attr("id",a.id);else if(o.id)e(l).attr("id","drum_"+o.id);else if(e(o).attr("name"))e(l).attr("id","drum_"+e(o).attr("name"));e(o).after(l);var c=document.createElement("div");e(c).addClass("inner");e(c).appendTo(l);var h=document.createElement("div");e(h).addClass("container");e(h).appendTo(c);var p=document.createElement("div");e(p).addClass("drum");e(p).appendTo(h);if(a.interactive===true){var d=t.up(a);e(l).append(d);var v=t.down(a);e(l).append(v);}a.radius=Math.round(e(p).height()/6/Math.tan(Math.PI/a.panelCount));a.mapping=[];var m=0;for(var f=0;f<a.panelCount;f++){if(a.data.length==f)break;var g=m;if(m>=a.panelCount/2){g=a.data.length-(a.panelCount-m)}m++;var y=new n(f,g,a);y.init();a.mapping.push(y);e(p).append(y.elem)}var b=function(e){e=e||a.rotation;var t=a.theta/2;var n=360;var r=((e+t)%n+n)%n;r=r-r%a.theta;var i=(a.data.length-1)*a.theta;if(r>i){if(e>0)return i;else return 0}return r};var w=function(){var e=b();for(var t in a.mapping){if(a.mapping[t].angle==e){return a.mapping[t]}}};var E=function(e){var t,n=[],r=a.panelCount,i=a.panelCount/2,s=a.data.length;var o=e.index;var u=e.dataModel.index;for(var f=u-i;f<=u+i-1;f++){t=f;if(f<0)t=s+f;if(f>s-1)t=f-s;n.push(t)}var l=n.slice(i-o);n=l.concat(n.slice(0,r-l.length));for(var o=0;o<a.mapping.length;o++){a.mapping[o].update(n[o])}};var S=function(t){e(p).css(a.transformProp,"translateZ(-"+a.radius+"px) "+a.rotateFn+"("+a.rotation+"deg)");var n=w();if(n){var r=n.dataModel;var i=o.selectedIndex;o.selectedIndex=r.index;if(t&&i!=r.index&&a.onChange)a.onChange(o);e(n.elem).css("opacity",1);e("figure:not(.a"+n.angle*100+", .hidden)",p).css("opacity","0.5");if(n.angle!=a.last_angle&&[0,90,180,270].indexOf(n.angle)>=0){a.last_angle=n.angle;E(n)}}};this.setIndex=function(e){var t=Math.floor(e/a.panelCount);var r=e-t*a.panelCount;var i=new n(r,e,a);E(i);a.rotation=r*a.theta;S(false)}}else{this.setIndex=function(e){o.selectedIndex=e}}this.setIndex(a.initselect);this.getIndex=function(){if(a.transformProp)return w().dataModel.index;else return o.selectedIndex};if(a.transformProp){if(typeof Hammer!="undefined"){a.touch=new Hammer(l,{prevent_default:true,no_mouseevents:true});a.touch.on("dragstart",function(e){a.distance=0});a.touch.on("drag",function(e){var t=["up","down"];if(t.indexOf(e.gesture.direction)>=0){a.rotation+=Math.round(e.gesture.deltaY-a.distance)*-1;S(true);a.distance=e.gesture.deltaY}});a.touch.on("dragend",function(e){a.rotation=b();S(true)})}if(a.interactive){e(d).click(function(e){var t=a.rotation+a.theta+1;a.rotation=b(t);S(true)});e(v).click(function(e){var t=a.rotation-a.theta-1;a.rotation=b(t);S(true)})}}};var i={getIndex:function(){if(e(this).data("drum"))return e(this).data("drum").getIndex();return false},setIndex:function(t){if(e(this).data("drum"))e(this).data("drum").setIndex(t)},init:function(t){var n=false;if(!navigator.userAgent.match(/Trident/i)&&!navigator.userAgent.match(/MSIE/i)){var i="transform WebkitTransform MozTransform OTransform msTransform".split(" ");for(var s=0;s<i.length;s++){if(document.createElement("div").style[i[s]]!==undefined){n=i[s]}}}var o=e(this);if(!o.data("drum")){var u=new r(o,t,n);o.data("drum",u)}}};e.fn.drum=function(t){var n=arguments;return this.each(function(){if(i[t]){return i[t].apply(this,Array.prototype.slice.call(n,1))}else if(typeof t==="object"||!t){return i.init.apply(this,n)}else{e.error("Method "+t+" does not exist on jQuery.drum")}})}})(jQuery)